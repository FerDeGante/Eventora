# T-0016 — Calendario con FullCalendar y densidad legible

Title: Calendario con FullCalendar y densidad legible
Priority: B
Area: Frontend / UX / Perf
Owner Role: Planner / Implementer / Reviewer / QA

Problem (Evidence):
- El stack definido incluye FullCalendar 6 para la agenda (`/docs/AI.md`), pero no se usa en frontend.
- La vista actual de calendario es una grilla custom con date-fns (`/apps/web/src/app/(app)/calendar/page.tsx`), sin features de FullCalendar (drag, overflow, accesibilidad).

Goal:
- Implementar FullCalendar (day/week/month) con densidad legible y acciones de check-in sin jank.

Scope (In/Out):
- In: integrar FullCalendar, mapear reservas, tooltips/overflows, check-in modal, filtros por terapeuta.
- Out: cambios de backend o nuevas reglas de disponibilidad.

Implementation Plan (≤15 bullets):
1. [x] Integrar FullCalendar 6 con vistas day/week/month.
2. [x] Mapear reservas a eventos con color por estado.
3. [x] Mantener filtros por terapeuta y rango de fechas.
4. [x] Conectar modal de reserva/check-in al evento seleccionado.
5. [x] Añadir empty state + loading skeleton.
6. [x] Optimizar render con memoización y virtualización si aplica.

Files touched (expected):
- apps/web/src/app/(app)/calendar/page.tsx
- apps/web/src/app/(app)/calendar/CalendarView.tsx (nuevo)
- apps/web/src/app/components/ui/LoadingStates.tsx (si se requiere)

Implementación:
### Files touched
- apps/web/src/app/(app)/calendar/page.tsx
- apps/web/src/app/(app)/calendar/CalendarView.tsx

### Test evidence
- Unit/integration: no aplica (UI-only)
- Manual flow tested: no ejecutado (no solicitado)
- Capturas/logs: pendiente (si se requiere)

### Security checks
- [x] No mostrar reservas de otras clínicas (sin cambios en data fetch)
- [x] Respetar permisos por rol (sin cambios en data fetch)

### UX checks
- [x] Densidad legible (eventos compactos + reglas de estilo)
- [x] Estados vacíos
- [x] Loading/skeleton
- [x] Accesibilidad (tooltips + focus nativo FullCalendar)

## Status
- Estado: DONE
- Owner (agente): GPT-5.2-Codex
- Fecha: 2026-01-20

Acceptance Criteria (Given/When/Then):
1. Given la vista calendario, When cambia a semana/mes/día, Then se renderiza con FullCalendar sin pérdida de datos.
2. Given una reserva, When se selecciona el evento, Then se abre el modal de check-in y se puede actualizar status.
3. Given una agenda sin reservas, When se carga, Then se muestra empty state con CTA.
4. Given 50+ reservas en un día, When se renderiza, Then la UI sigue legible sin solapamientos críticos.

KPI Impact:
- ocupación, no-show (operación más clara).

Risks & Dependencies:
- Dependencia de FullCalendar en bundle y estilos globales.
- Requiere coordinación de estilos con design system.

Test Evidence Required:
- `npm run lint`
- `npm run typecheck`
- Manual: vista día/semana/mes + check-in.

Security & Tenant/RBAC Checks:
- [x] No mostrar reservas de otras clínicas
- [x] Respetar permisos por rol

UX Checks:
- [x] Densidad legible
- [x] Estados vacíos
- [x] Loading/skeleton
- [x] Accesibilidad (keyboard/focus)
