# T-0017 ‚Äî Resolver vulnerabilidades de dependencias npm

## Contexto
- Problema: GitHub detect√≥ 7 vulnerabilidades en dependencias (1 cr√≠tica, 4 high, 2 moderate) que ponen en riesgo la seguridad del sistema.
- Por qu√© importa (KPI impactado): Vulnerabilidades cr√≠ticas pueden causar RCE, DoS, y exposici√≥n de c√≥digo fuente, afectando disponibilidad y seguridad de datos.
- Usuarios afectados (rol): Todos los usuarios, especialmente ADMIN/MANAGER por acceso a datos sensibles.

## Alcance
- Incluye: 
  - Actualizar Next.js 16.0.0-beta.0 ‚Üí 16.1.0+ (RCE cr√≠tico)
  - Actualizar jws, qs, tar, nodemailer, fast-jwt
  - Ejecutar `npm audit fix` y verificar breaking changes
  - Smoke testing post-actualizaci√≥n
- No incluye: Refactorizaci√≥n mayor de c√≥digo o cambio de frameworks.

## Criterios de aceptaci√≥n (exactos)
1) `npm audit` ejecutado en apps/web muestra 0 vulnerabilidades critical/high.
2) Next.js actualizado a versi√≥n stable ‚â•16.1.0 sin vulnerabilidades conocidas.
3) Aplicaci√≥n funciona correctamente: login, booking, checkout, dashboard verificados.
4) Todas las pruebas E2E pasan sin regresiones.

## Plan (lo llena el agente antes de codear)
- [ ] Ejecutar `npm audit fix` en apps/web y revisar cambios.
- [ ] Actualizar manualmente Next.js a versi√≥n stable si `audit fix` no es suficiente.
- [ ] Revisar changelog de paquetes actualizados para breaking changes.
- [ ] Ejecutar tests unitarios y E2E para validar.
- [ ] Smoke test manual: login ‚Üí dashboard ‚Üí booking ‚Üí checkout.
- [ ] Verificar `npm audit` muestra 0 critical/high.
- [ ] Documentar versiones actualizadas.

## Implementaci√≥n
### Files touched
- apps/web/package.json
- apps/web/pnpm-lock.yaml

### Vulnerabilidades detectadas
| Paquete | Versi√≥n Actual | Severidad | CVE/GHSA | Fix |
|---------|----------------|-----------|----------|-----|
| next | 16.0.0-beta.0 | üî¥ Critical | GHSA-9qr9-h5gf-34mp (RCE) | ‚â•16.1.0 |
| next | 16.0.0-beta.0 | üî¥ High | GHSA-w37m-7fhw-fmv9 (Source Exposure) | ‚â•16.1.0 |
| next | 16.0.0-beta.0 | üî¥ High | GHSA-mwv6-3258-q52c (DoS) | ‚â•16.1.0 |
| jws | 4.0.0 | üî¥ High | GHSA-869p-cjfg-cm3x (HMAC bypass) | audit fix |
| qs | <6.14.1 | üî¥ High | GHSA-6rw7-vpxm-498p (DoS) | ‚â•6.14.1 |
| tar | ‚â§7.5.2 | üî¥ High | GHSA-8qq5-rm4j-mr97 (File overwrite) | >7.5.2 |
| nodemailer | ‚â§7.0.10 | üü° Moderate | GHSA-rcmh-qjqh-p98v (DoS) | >7.0.10 |
| fast-jwt | <5.0.6 | üü° Moderate | GHSA-gm45-q3v2-6cf8 (iss claim) | ‚â•5.0.6 |

### Test evidence
- Unit/integration: Pendiente (`npm run test --workspace web`)
- Manual flow tested: Pendiente (login, booking, checkout)
- Capturas/logs (si aplica): N/A

### Security checks
- [x] Validaci√≥n server-side (no afectada)
- [x] Tenant guard (no afectada)
- [x] RBAC (no afectada)
- [x] Webhook signature (no afectada)
- [ ] Verificar `npm audit` post-fix

### UX checks
- [ ] Verificar UI sin regresiones
- [ ] Verificar navegaci√≥n funciona
- [ ] Verificar forms/validaci√≥n
- [ ] Verificar Stripe checkout

## Riesgos / notas
- **Next.js 16.0.0-beta.0 ‚Üí stable:** Puede tener breaking changes. Revisar [changelog](https://github.com/vercel/next.js/releases).
- **jws/qs/tar:** Dependencias transitivas, `npm audit fix` deber√≠a resolverlas autom√°ticamente.
- **Bloqueo de launch:** Vulnerabilidad cr√≠tica RCE debe resolverse antes de producci√≥n.

## Status
- Estado: TODO
- Owner (agente): Pending
- Fecha: 2026-01-20
